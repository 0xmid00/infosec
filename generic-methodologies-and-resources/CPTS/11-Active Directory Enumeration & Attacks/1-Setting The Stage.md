## # Introduction to Active Directory Enumeration & Attacks
- **What is AD?**  
    Active Directory is a Windows-based service used to manage users, computers, and other resources in a network. It helps with **authentication, authorization, and organization** of network resources.
    
- **Why is AD important?**
    
    - It's widely used (over 43% market share).
        
    - Often contains **misconfigurations** and **vulnerabilities** that attackers can exploit.
        
    - Microsoft continues to update and integrate it with **Azure AD**.
        
- **Why attackers care about AD?**
    
    - Weak settings can be abused (e.g., password spraying, Kerberoasting).
        
    - AD environments offer many paths to **gain access** or **escalate privileges**.

| Year                                                                                        | Overflow                                                                                                                              | Memory Corruption                                                                                                                                | Sql Injection                                                                                                                              | XSS                                                                                                                                               | Directory Traversal                                                                                                                              | File Inclusion                                                                                                                                 | CSRF                                                                                                                                                           | XXE                                                                                                                                                             | SSRF                                                                                                                                                            | Open Redirect                                                                                                                                 | Input Validation                                                                                                                               |
| ------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| [2015](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2015/Microsoft.html) | [10](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2015/opov-1/Microsoft.html "Overflow vulnerabilities for 2015")  | [271](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2015/opmemc-1/Microsoft.html "Memory corruption vulnerabilities for 2015") | 0                                                                                                                                          | [31](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2015/opxss-1/Microsoft.html "Cross site scripting vulnerabilities for 2015") | [2](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2015/opdirt-1/Microsoft.html "Directory traversal vulnerabilities for 2015") | 0                                                                                                                                              | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2015/opcsrf-1/Microsoft.html "Cross site request forgery, CSRF, vulnerabilities for 2015") | [2](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2015/opxxe-1/Microsoft.html "XML external entity, XXE, injection vulnerabilities for 2015") | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2015/opssrf-1/Microsoft.html "Server-side request forgery (SSRF) vulnerabilities for 2015") | 0                                                                                                                                             | 0                                                                                                                                              |
| [2016](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2016/Microsoft.html) | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2016/opov-1/Microsoft.html "Overflow vulnerabilities for 2016")   | [177](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2016/opmemc-1/Microsoft.html "Memory corruption vulnerabilities for 2016") | 0                                                                                                                                          | [15](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2016/opxss-1/Microsoft.html "Cross site scripting vulnerabilities for 2016") | 0                                                                                                                                                | 0                                                                                                                                              | 0                                                                                                                                                              | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2016/opxxe-1/Microsoft.html "XML external entity, XXE, injection vulnerabilities for 2016") | 0                                                                                                                                                               | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2016/opopenred-1/Microsoft.html "Open redirect vulnerabilities for 2016") | 0                                                                                                                                              |
| [2017](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2017/Microsoft.html) | [252](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2017/opov-1/Microsoft.html "Overflow vulnerabilities for 2017") | [191](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2017/opmemc-1/Microsoft.html "Memory corruption vulnerabilities for 2017") | 0                                                                                                                                          | [20](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2017/opxss-1/Microsoft.html "Cross site scripting vulnerabilities for 2017") | 0                                                                                                                                                | 0                                                                                                                                              | [2](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2017/opcsrf-1/Microsoft.html "Cross site request forgery, CSRF, vulnerabilities for 2017") | [3](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2017/opxxe-1/Microsoft.html "XML external entity, XXE, injection vulnerabilities for 2017") | 0                                                                                                                                                               | [2](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2017/opopenred-1/Microsoft.html "Open redirect vulnerabilities for 2017") | [60](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2017/opinpv-1/Microsoft.html "Input valdiation vulnerabilities for 2017") |
| [2018](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2018/Microsoft.html) | [16](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2018/opov-1/Microsoft.html "Overflow vulnerabilities for 2018")  | [184](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2018/opmemc-1/Microsoft.html "Memory corruption vulnerabilities for 2018") | 0                                                                                                                                          | [53](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2018/opxss-1/Microsoft.html "Cross site scripting vulnerabilities for 2018") | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2018/opdirt-1/Microsoft.html "Directory traversal vulnerabilities for 2018") | [9](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2018/opfileinc-1/Microsoft.html "File inclusion vulnerabilities for 2018") | [2](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2018/opcsrf-1/Microsoft.html "Cross site request forgery, CSRF, vulnerabilities for 2018") | [7](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2018/opxxe-1/Microsoft.html "XML external entity, XXE, injection vulnerabilities for 2018") | [3](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2018/opssrf-1/Microsoft.html "Server-side request forgery (SSRF) vulnerabilities for 2018") | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2018/opopenred-1/Microsoft.html "Open redirect vulnerabilities for 2018") | [37](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2018/opinpv-1/Microsoft.html "Input valdiation vulnerabilities for 2018") |
| [2019](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2019/Microsoft.html) | [8](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2019/opov-1/Microsoft.html "Overflow vulnerabilities for 2019")   | [119](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2019/opmemc-1/Microsoft.html "Memory corruption vulnerabilities for 2019") | 0                                                                                                                                          | [47](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2019/opxss-1/Microsoft.html "Cross site scripting vulnerabilities for 2019") | [3](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2019/opdirt-1/Microsoft.html "Directory traversal vulnerabilities for 2019") | [4](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2019/opfileinc-1/Microsoft.html "File inclusion vulnerabilities for 2019") | [3](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2019/opcsrf-1/Microsoft.html "Cross site request forgery, CSRF, vulnerabilities for 2019") | [8](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2019/opxxe-1/Microsoft.html "XML external entity, XXE, injection vulnerabilities for 2019") | 0                                                                                                                                                               | [3](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2019/opopenred-1/Microsoft.html "Open redirect vulnerabilities for 2019") | [39](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2019/opinpv-1/Microsoft.html "Input valdiation vulnerabilities for 2019") |
| [2020](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2020/Microsoft.html) | [4](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2020/opov-1/Microsoft.html "Overflow vulnerabilities for 2020")   | [91](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2020/opmemc-1/Microsoft.html "Memory corruption vulnerabilities for 2020")  | 0                                                                                                                                          | [81](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2020/opxss-1/Microsoft.html "Cross site scripting vulnerabilities for 2020") | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2020/opdirt-1/Microsoft.html "Directory traversal vulnerabilities for 2020") | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2020/opfileinc-1/Microsoft.html "File inclusion vulnerabilities for 2020") | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2020/opcsrf-1/Microsoft.html "Cross site request forgery, CSRF, vulnerabilities for 2020") | 0                                                                                                                                                               | 0                                                                                                                                                               | [3](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2020/opopenred-1/Microsoft.html "Open redirect vulnerabilities for 2020") | [29](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2020/opinpv-1/Microsoft.html "Input valdiation vulnerabilities for 2020") |
| [2021](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2021/Microsoft.html) | [10](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2021/opov-1/Microsoft.html "Overflow vulnerabilities for 2021")  | [36](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2021/opmemc-1/Microsoft.html "Memory corruption vulnerabilities for 2021")  | [3](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2021/opsqli-1/Microsoft.html "Sql injection vulnerabilities for 2021") | [10](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2021/opxss-1/Microsoft.html "Cross site scripting vulnerabilities for 2021") | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2021/opdirt-1/Microsoft.html "Directory traversal vulnerabilities for 2021") | 0                                                                                                                                              | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2021/opcsrf-1/Microsoft.html "Cross site request forgery, CSRF, vulnerabilities for 2021") | 0                                                                                                                                                               | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2021/opssrf-1/Microsoft.html "Server-side request forgery (SSRF) vulnerabilities for 2021") | 0                                                                                                                                             | [3](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2021/opinpv-1/Microsoft.html "Input valdiation vulnerabilities for 2021")  |
| [2022](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2022/Microsoft.html) | [7](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2022/opov-1/Microsoft.html "Overflow vulnerabilities for 2022")   | [7](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2022/opmemc-1/Microsoft.html "Memory corruption vulnerabilities for 2022")   | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2022/opsqli-1/Microsoft.html "Sql injection vulnerabilities for 2022") | [2](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2022/opxss-1/Microsoft.html "Cross site scripting vulnerabilities for 2022")  | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2022/opdirt-1/Microsoft.html "Directory traversal vulnerabilities for 2022") | 0                                                                                                                                              | 0                                                                                                                                                              | 0                                                                                                                                                               | 0                                                                                                                                                               | 0                                                                                                                                             | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2022/opinpv-1/Microsoft.html "Input valdiation vulnerabilities for 2022")  |
| [2023](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2023/Microsoft.html) | [3](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2023/opov-1/Microsoft.html "Overflow vulnerabilities for 2023")   | [10](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2023/opmemc-1/Microsoft.html "Memory corruption vulnerabilities for 2023")  | 0                                                                                                                                          | [24](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2023/opxss-1/Microsoft.html "Cross site scripting vulnerabilities for 2023") | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2023/opdirt-1/Microsoft.html "Directory traversal vulnerabilities for 2023") | 0                                                                                                                                              | 0                                                                                                                                                              | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2023/opxxe-1/Microsoft.html "XML external entity, XXE, injection vulnerabilities for 2023") | 0                                                                                                                                                               | 0                                                                                                                                             | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2023/opinpv-1/Microsoft.html "Input valdiation vulnerabilities for 2023")  |
| [2024](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2024/Microsoft.html) | [2](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2024/opov-1/Microsoft.html "Overflow vulnerabilities for 2024")   | [6](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2024/opmemc-1/Microsoft.html "Memory corruption vulnerabilities for 2024")   | 0                                                                                                                                          | [11](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2024/opxss-1/Microsoft.html "Cross site scripting vulnerabilities for 2024") | [2](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2024/opdirt-1/Microsoft.html "Directory traversal vulnerabilities for 2024") | 0                                                                                                                                              | [1](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2024/opcsrf-1/Microsoft.html "Cross site request forgery, CSRF, vulnerabilities for 2024") | 0                                                                                                                                                               | [2](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2024/opssrf-1/Microsoft.html "Server-side request forgery (SSRF) vulnerabilities for 2024") | 0                                                                                                                                             | [2](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2024/opinpv-1/Microsoft.html "Input valdiation vulnerabilities for 2024")  |
| [2025](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2025/Microsoft.html) | [75](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2025/opov-1/Microsoft.html "Overflow vulnerabilities for 2025")  | [91](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2025/opmemc-1/Microsoft.html "Memory corruption vulnerabilities for 2025")  | [2](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2025/opsqli-1/Microsoft.html "Sql injection vulnerabilities for 2025") | [2](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2025/opxss-1/Microsoft.html "Cross site scripting vulnerabilities for 2025")  | [3](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2025/opdirt-1/Microsoft.html "Directory traversal vulnerabilities for 2025") | 0                                                                                                                                              | 0                                                                                                                                                              | 0                                                                                                                                                               | [5](https://www.cvedetails.com/vulnerability-list/vendor_id-26/year-2025/opssrf-1/Microsoft.html "Server-side request forgery (SSRF) vulnerabilities for 2025") | 0                                                                                                                                             | 0                                                                                                                                              |

## Real-World Examples

**Scenario 1 - Waiting On An Admin**
> During this engagement, I compromised a single host and gained `SYSTEM` level access. Because this was a domain-joined host, I was able to use this access to enumerate the domain. I went through all of the standard enumeration, but did not find much. There were `Service Principal Names` (SPNs) present within the environment, and I was able to perform a Kerberoasting attack and retrieve TGS tickets for a few accounts. I attempted to crack these with Hashcat and some of my standard wordlists and rules, but was unsuccessful at first. I ended up leaving a cracking job running overnight with a very large wordlist combined with the [d3ad0ne](https://github.com/hashcat/hashcat/blob/master/rules/d3ad0ne.rule) rule that ships with Hashcat. The next morning I had a hit on one ticket and retrieved the cleartext password for a user account. This account did not give me significant access, but it did give me write access on certain file shares. I used this access to drop SCF files around the shares and left Responder going. After a while, I got a single hit, the `NetNTLMv2 hash` of a user. I checked through the BloodHound output and noticed that this user was actually a domain admin! Easy day from here.

**Scenario 2 - Spraying The Night Away**
> Password spraying can be an extremely effective way to gain a foothold in a domain, but we must exercise great care not to lock out user accounts in the process. On one engagement, I found an SMB NULL session using the [enum4linux](https://github.com/CiscoCXSecurity/enum4linux) tool and retrieved both a listing of `all` users from the domain, and the domain `password policy`. Knowing the password policy was crucial because I could ensure that I was staying within the parameters to not lock out any accounts and also knew that the policy was a minimum eight-character password and password complexity was enforced (meaning that a user's password required 3/4 of special character, number, uppercase, or lower case number, i.e., Welcome1). I tried several common weak passwords such as Welcome1, `Password1`, Password123, `Spring2018`, etc. but did not get any hits. Finally, I made an attempt with `Spring@18` and got a hit! Using this account, I ran BloodHound and found several hosts where this user had local admin access. I noticed that a domain admin account had an active session on one of these hosts. I was able to use the Rubeus tool and extract the Kerberos TGT ticket for this domain user. From there, I was able to perform a `pass-the-ticket` attack and authenticate as this domain admin user. As a bonus, I was able to take over the trusting domain as well because the Domain Administrators group for the domain that I took over was a part of the Administrators group in the trusting domain via nested group membership, meaning I could use the same set of credentials to authenticate to the other domain with full administrative level access.

**Scenario 3 - Fighting In The Dark**

>I had tried all of my standard ways to obtain a foothold on this third engagement, and nothing had worked. I decided that I would use the [Kerbrute](https://github.com/ropnop/kerbrute) tool to attempt to enumerate valid usernames and then, if I found any, attempt a targeted password spraying attack since I did not know the password policy and didn't want to lock any accounts out. I used the [linkedin2username](https://github.com/initstring/linkedin2username) tool to first mashup potential usernames from the company's LinkedIn page. I combined this list with several username lists from the [statistically-likely-usernames](https://github.com/insidetrust/statistically-likely-usernames) GitHub repo and, after using the `userenum` feature of Kerbrute, ended up with **516** valid users. I knew I had to tread carefully with password spraying, so I tried with the password `Welcome2021` and got a single hit! Using this account, I ran the Python version of BloodHound from my attack host and found that all domain users had RDP access to a single box. I logged into this host and used the PowerShell tool [DomainPasswordSpray](https://github.com/dafthack/DomainPasswordSpray) to spray again. I was more confident this time around because I could a) view the password policy and b) the DomainPasswordSpray tool will remove accounts close to lockout from the target list. Being that I was authenticated within the domain, I could now spray with all domain users, which gave me significantly more targets. I tried again with the common password Fall2021 and got several hits, all for users not in my initial wordlist. I checked the rights for each of these accounts and found that one was in the Help Desk group, which had [GenericAll](https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#genericall) rights over the [Enterprise Key Admins](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#enterprise-key-admins) group. The Enterprise Key Admins group had GenericAll privileges over a domain controller, so I added the account I controlled to this group, authenticated again, and inherited these privileges. Using these rights, I performed the [Shadow Credentials](https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab) attack and retrieved the NT hash for the domain controller machine account. With this NT hash, I was then able to perform a DCSync attack and retrieve the NTLM password hashes for all users in the domain because a domain controller can perform replication, which is required for DCSync.