## 1- Detection

Detecting basic OS Command Injection vulnerabilities is done by attempting to append system commands to the application's normal functionality. If the output changes, the vulnerability is confirmed. For more advanced cases, fuzzing and code review may be required. This section focuses on basic cases where user input directly reaches system command execution without sanitization.
#### Command Injection Detection
When interacting with an application that accepts user input (such as a Host Checker that pings an IP), if the backend uses a command like `ping -c 1 INPUT`, unsanitized input may allow attackers to append additional commands. By testing different payloads, we can determine if the application is vulnerable.
### Command Injection Methods
we may use any of the following operators:

| **Injection Operator** | **Injection Character** | **URL-Encoded Character** | **Executed Command**                       |
| ---------------------- | ----------------------- | ------------------------- | ------------------------------------------ |
| Semicolon              | `;`                     | `%3b`                     | Both                                       |
| New Line               | `\n`                    | `%0a`                     | Both                                       |
| Background             | `&`                     | `%26`                     | Both (second output generally shown first) |
| Pipe                   | \|                      | `%7c`                     | Both (only second output is shown)         |
| AND                    | `&&`                    | `%26%26`                  | Both (only if first succeeds)              |
| OR                     | \|\|                    | `%7c%7c`                  | Second (only if first fails)               |
| Sub-Shell              | ` `` `                  | `%60%60`                  | Both **(Linux-only)**                      |
| Sub-Shell              | `$()`                   | `%24%28%29`               | Both **(Linux-only)**                      |
 this operators allow chaining commands so that both, one, or conditional commands execute depending on operator behavior.


---

## 2- Injecting Commands
After identifying that the `Host Checker` application may be vulnerable to command injection, we test different injection methods. The first attempt uses the semicolon (`;`) operator to append a second command.
#### Injecting Our Command
Using the payload `127.0.0.1; whoami`, the backend would execute:
```bash
ping -c 1 127.0.0.1; whoami
```
Running this on a Linux machine confirms that both commands execute successfully, proving the method works.  
However, when entering the payload into the web form, the front-end rejects it due to IP-format validation. Developer tools show that **no request is sent to the server**, meaning the validation occurs only on the front-end.
#### Bypassing Front-End Validation

Front-end validation can be bypassed since it does not affect the actual server-side logic. By intercepting the request using **Burp Suite** or **ZAP**, we can modify the HTTP request manually and send custom payloads to the backend.

- Intercept request with Burp
- Send it to Repeater
- Modify the `ip` parameter to `127.0.0.1; whoami`
- URL-encode the payload
- Send the request -> Successful Injection

![[Pasted image 20251119103734.png]]
**Result:**  
The server response contains:  Output of the `ping` command +  Output of the injected `whoami` command


---

## 3- Other Injection Operators
We test additional command injection operators to understand how each behaves when appended to user input.
#### AND Operator
Using `&&` lets the second command run **only if the first succeeds**.  
Payload: `127.0.0.1 && whoami`  
```bash
ping -c 1 127.0.0.1 && whoami
```
Result: both commands execute successfully.  
Sending the payload through Burp (URL-encoded) confirms the backend executes both commands as expected.
#### OR Operator
using  `||` runs the second command **only if the first fails**.  
Payload: `127.0.0.1 || whoami` does **not** run `whoami` because `ping` succeeds.
To force execution, break the first command:  
Payload: `|| whoami`  
```bash
ping -c 1 || whoami
```
Result: `ping` fails → `whoami` executes.  
Sending this payload through Burp returns only the second command’s output, producing a clean result.
#### Injection Operators in Other Vulnerabilities
the most common operators that can be used for injections:

| **Injection Type**                      | **Operators**                                     |
| --------------------------------------- | ------------------------------------------------- |
| SQL Injection                           | `'` `,` `;` `--` `/* */`                          |
| Command Injection                       | `;` `&&`                                          |
| LDAP Injection                          | `*` `(` `)` `&` `\|`                              |
| XPath Injection                         | `'` `or` `and` `not` `substring` `concat` `count` |
| OS Command Injection                    | `;` `&` `\|`                                      |
| Code Injection                          | `'` `;` `--` `/* */` `$()` `${}` `#{}` `%{}` `^`  |
| Directory Traversal/File Path Traversal | `../` `..\\` `%00`                                |
| Object Injection                        | `;` `&` `\|`                                      |
| XQuery Injection                        | `'` `;` `--` `/* */`                              |
| Shellcode Injection                     | `\x` `\u` `%u` `%n`                               |
| Header Injection                        | `\n` `\r\n` `\t` `%0d` `%0a` `%09`                |

