


---

#  Users Enumeration and Password Spray Attack

## **1. Overview**

- Purpose: Perform user enumeration and password spray attacks on target services.
- Tools Used:
    - **Metasploit**: `smtp_enum` auxiliary module.
    - **Hydra**: Brute-force tool for password spray attacks.
- Target Services: SMTP, SSH, SMB, and other credential-based systems.

---

## **2. User Enumeration with Metasploit**

### **2.1 Preparing the User List**

- Use statistically likely usernames:
    
    ```bash
    head -n 50 john.txt >> users.txt
    ```
    
    - **Source**: [Statistically Likely Usernames](https://github.com/insidetrust/statistically-likely-usernames)

### **2.2 Enumerating Users**

- Load the `smtp_enum` module in Metasploit:
    
    ```bash
    msf > use auxiliary/scanner/smtp/smtp_enum
    ```
    
- Configure the module:
    
    ```bash
    set RHOSTS <SMTP_SERVER_IP>
    set USER_FILE users.txt
    run
    ```
    
- Output: Identifies valid users (e.g., saves to `valid_users.txt`).

---

## **3. Password Spray Attack**

### **3.1 Creating a Password List**

- Use commonly predictable passwords:
    - Format: `Season[Year]` (e.g., `Spring2018`, `Fall2024`).
    - Target-related passwords: `CompanyName01`, `CompanyName02`, etc.
- Save to `passwords.txt`.

### **3.2 Executing the Attack (SSH Example)**

- Use **Hydra** to attack the SSH service:
    
    ```bash
    hydra -L users.txt -P passwords.txt ssh://<TARGET_IP>
    ```
    
- Example Output:
    - User: `david`
    - Password: `Spring2018`

### **3.3 Expanding Access**

- Check for password reuse across systems:
    
    ```bash
    hydra -l david -p Spring2018 -M ssh_servers.txt ssh
    ```
    
    - **`ssh_servers.txt`**: File containing target SSH servers (one per line).

---

## **4. Additional Targets**

- Other services for password spray attacks:
    - **SMB**: Use Metasploit’s `smb_login` module.
        
        ```bash
        use auxiliary/scanner/smb/smb_login
        ```
        
    - **OWA**: Test with `owa_login` module for Outlook Web Access.
        
        ```bash
        use auxiliary/scanner/http/owa_login
        ```
        

---

## **5. Best Practices and Cautions**

### **5.1 Avoid Detection**

- Limit attempts:
    - **Recommended**: 1-2 passwords per run.
    - **Wait Time**: Minimum 45 minutes between runs.
- Ensure tools don’t test blank passwords or extra variations.
    - Risk: Account lockouts or detection by security solutions.

### **5.2 Optimize Password Selection**

- Predictable Patterns:
    - `Password01` → `Password02`
    - `Spring2018` → `Summer2018`
- Use intelligence from the target environment.

---

## **6. Summary**

1. **User Enumeration**:
    - Gather usernames from likely sources and validate them using `smtp_enum`.
2. **Password Spray**:
    - Create a password list with common patterns and test against target services.
3. **Expand Access**:
    - Check for password reuse to compromise additional systems.
4. **Target Other Services**:
    - Extend attacks to SMB, OWA, or other authentication systems.

---

## **References**

- [Metasploit `smtp_enum` Module](https://www.rapid7.com/db/modules/auxiliary/scanner/smtp/smtp_enum)
- [Hydra](https://github.com/vanhauser-thc/thc-hydra)
- [Statistically Likely Usernames](https://github.com/insidetrust/statistically-likely-usernames)

---

